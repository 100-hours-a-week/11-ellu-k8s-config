# 로키 로그 수집 설정 (EKS 검증된 구성 기반)
fullnameOverride: "loki"
nameOverride: "loki"

# 배포 모드
deploymentMode: SimpleScalable

loki:
  auth_enabled: false
  
  schemaConfig:
    configs:
      - from: "2020-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h
  
  storage_config:
    filesystem:
      directory: /var/loki/chunks
    tsdb_shipper:
      active_index_directory: /var/loki/tsdb-index
      cache_location: /var/loki/tsdb-cache
  
  limits_config:
    retention_period: 672h # 28일
  
  storage:
    type: filesystem

# Single Binary 비활성화
singleBinary:
  replicas: 0

# Backend 컴포넌트
backend:
  replicas: 2
  maxUnavailable: 1
  nodeSelector:
    cloud-provider: aws
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: true
    storageClassName: "ebs-sc"
    size: 20Gi

# Read 컴포넌트
read:
  replicas: 2
  maxUnavailable: 1
  nodeSelector:
    cloud-provider: aws
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Write 컴포넌트
write:
  replicas: 2
  maxUnavailable: 1
  nodeSelector:
    cloud-provider: aws
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: true
    storageClassName: "ebs-sc"
    size: 20Gi

# 청크 캐시 (EKS 설정 유지)
chunksCache:
  enabled: true
  nodeSelector:
    cloud-provider: aws
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  chunkSizeLimit: 1Gi
  memoryLimitMb: 512

# Results 캐시
resultsCache:
  enabled: true

# 서비스 어카운트 (kubeadm용 - EKS 어노테이션 제거)
serviceAccount:
  create: true
  name: "loki"
  annotations: {}

# 게이트웨이
gateway:
  enabled: true
  replicas: 2
  maxUnavailable: 1
  nodeSelector:
    cloud-provider: aws

# 서비스 설정
service:
  type: ClusterIP
  port: 3100

# 서비스 모니터
serviceMonitor:
  enabled: true
  interval: 15s
  scrapeTimeout: 10s

# 테스트 비활성화
test:
  enabled: false